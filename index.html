<!DOCTYPE html>
<html>
    <head>
        <title>Bouncing Ball</title>
        <meta charset="UTF-8">
    </head>

    <body>
        <center><canvas id="canvas"></canvas></center>
        <blockquote>If any one were to ask me what in my opinion was the dullest and most stupid spot on the face of the Earth, I should decidedly say Chelmsford.</blockquote>
    </body>

    <script>

const canvas    = document.getElementById("canvas");
const ctx       = canvas.getContext("2d");
const width     = screen.availWidth - 50;
const height    = screen.availHeight - 150;

canvas.width    = width;
canvas.height   = height;

const distance = p1 => p2 => Math.hypot(p2.x-p1.x, p2.y-p1.y);
const between = x => a => b => x >= a && x <= b;
const setWithin = x => a => b => Math.max(Math.min(x, b), a);

const Ball = function (x, y, color) {
    this.x = x;
    this.y = y;
    this.color = color;
    this.xv = 0;
    this.yv = 0;
    this.dragged = false;
    balls.push(this);
};
Ball.physics = function (ball) {
    ball.yv += 0.981;
    ball.x += ball.xv;
    ball.y += ball.yv;
    if (!between(ball.x)(10)(width-10)) {
        ball.x = setWithin(ball.x)(10)(width-10);
        ball.xv = -ball.xv/2;
    };
    if (ball.y >= height - 10) {
        ball.xv -= Math.sign(ball.xv)*0.2;
    };
    if (!between(ball.y)(10)(height-10)) {
        ball.y = setWithin(ball.y)(10)(height-10);
        ball.yv = -ball.yv/2;
    };
};
Ball.update = function (ball) {
    if (!ball.dragged) Ball.physics(ball);
    let {x, y, color} = ball;
    ctx.fillStyle = color;
    ctx.beginPath();
        ctx.arc(x, y, 10, 0, 2*Math.PI);
    ctx.fill();
};

const balls = [];
var selectedBall = null;

new Ball(100, 100, "red");

let mouse = {x: 0, y: 0, xv: 0, yv: 0};
const mouseUpdate = e => {
    mouse.xv = e.clientX - mouse.x;
    mouse.yv = e.clientY - mouse.y;
    mouse.x = e.clientX;
    mouse.y = e.clientY;
};
document.addEventListener("mousemove", mouseUpdate);

const selectBall = e => {
    balls.forEach(ball => {
        if (distance(ball)(mouse) <= 30) selectedBall = ball;
        ball.dragged = true;
    });
};
const deselectBall = e => {
    if (!selectedBall) return;
    selectedBall.dragged = false;
    selectedBall.xv = mouse.xv;
    selectedBall.yv = mouse.yv;
    selectedBall = null;
};
document.addEventListener("mousedown", selectBall);
document.addEventListener("mouseup", deselectBall);

const mainloop  = () => {
    ctx.clearRect(0, 0, width, height);
    ctx.strokeRect(0, 0, width, height);
    balls.forEach(Ball.update);
    if (selectedBall) {
        selectedBall.x = mouse.x - 5;
        selectedBall.y = mouse.y - 5;
    };
    requestAnimationFrame(mainloop);
};

requestAnimationFrame(mainloop);

    </script>
</html>